# ==========================================
# GENERAL MAKEFILE WITH GNUWIN32 FIX
# ==========================================

# 1. Configuration: Change these to match your file names
TARGET_BASE = math_icg
INPUT_FILE  = math_input.txt
OUTPUT_FILE = math_result.txt

# 2. GnuWin32 Fixes: Setting Environment Variables for M4 and Bison
# These replace the manual PowerShell commands
export M4 = C:/PROGRA~2/GnuWin32/bin/m4.exe
export BISON_PKGDATADIR = C:/PROGRA~2/GnuWin32/share/bison

# 3. Tool Settings
CC      = gcc
LEX     = flex
YACC    = bison
YFLAGS  = -d
LIBS    = -lm

# 4. Derived Names
EXECUTABLE = compiler_front
LEX_OUT    = lex.yy.c
YACC_C     = $(TARGET_BASE).tab.c
YACC_H     = $(TARGET_BASE).tab.h

# --- Build Rules ---

all: $(EXECUTABLE)

$(EXECUTABLE): $(LEX_OUT) $(YACC_C)
	$(CC) $(LEX_OUT) $(YACC_C) -o $(EXECUTABLE) $(LIBS)

$(LEX_OUT): $(TARGET_BASE).l $(YACC_H)
	$(LEX) $(TARGET_BASE).l

$(YACC_C) $(YACC_H): $(TARGET_BASE).y
	$(YACC) $(YFLAGS) $(TARGET_BASE).y

# Run command: Compiles, runs, and displays result
run: all
	./$(EXECUTABLE) > $(OUTPUT_FILE)
	@echo "------------------------------------------"
	@echo "SUCCESS: Results saved in $(OUTPUT_FILE)"
	@echo "Contents of $(OUTPUT_FILE):"
	@cat $(OUTPUT_FILE)
	@echo "------------------------------------------"

clean:
	rm -f $(LEX_OUT) $(YACC_C) $(YACC_H) $(EXECUTABLE) $(OUTPUT_FILE)
	@echo "Cleanup complete."

.PHONY: all run clean